/*=======================================
 * Created by Florian St√∂tzel on 23.01.2015.
 /=======================================*/

/*jslint node: true */
'use strict';

var sanitize = require('./sanitize');


/*==================================================
 * Takes the JSON file, generated by the license-checker from
 * and puts its contents into a html table
 /==================================================*/
 
function createHTML (json, grunt) {

  var output = '<!DOCTYPE html>\n<html><head><title>License report for ' + grunt.config.data.pkg.name + ' v' + grunt.config.data.pkg.version + '</title>\n' +
    '<style type="text/css">\n' +
    'html, body {\n' +
    'background-color: #FFFFFF;\n' +
    'color: #333333;\n' +
    'font-family: Arial,sans-serif;\n' +
    'font-size: 14px; \n' +
    'line-height: 1.42857; \n' +
    'padding: 0:\n' +
    'margin: 0;\n' +
    '}\n' +
    'table th, td {\n' +
    'text-align: left;\n' +
    '}' +
    '.error {' +
    'color: #ff0000;' +
    'font-weight:bold;' +
    '}</style>\n</head>\n<body>\n<h1>License report for ' + grunt.config.data.pkg.name + ' v' + grunt.config.data.pkg.version + '</h1>\n<table border="1">\n<tr>\n<th>Project</th><th>License</th><th>Repository</th>\n</tr>';

  /*
   * Get the name of every top node inside the json.
   * In this case, the node name is the name of the package, that we are currently looking at.
   */
  var packageNames = Object.getOwnPropertyNames(json);

  packageNames.forEach(function (packageName) {
    var repoUrl = sanitize.parseUrl(json[packageName].repository);

    output += '\n<tr>\n<td>' + packageName + '</td>';
    output += '\n<td>' + sanitize.parseLicense(json[packageName].licenses, packageName, grunt) + '</td>';

    // Filter undefined urls
    if(repoUrl) {
      output += '\n<td><a href="' + repoUrl + '" target="_blank">' + repoUrl + '</a></td>\n</tr>';
    }
    else {
      output += '\n<td><span class="error">Undefined</span></td>\n</tr>';
    }
  });

  output += '\n</table></body></html>';

  return output;

}


exports.createHTML = createHTML;